# Klatt - 语音合成参数调整工具

## 项目简介
`klatt` 是一个基于经典的 Klatt 语音合成器 (1980版) 的可视化参数调整与合成工具。它允许用户深入探索语音产生的声学机制，通过精确控制声源参数（如基频 F0、振幅 AV）和声道参数（共振峰频率、带宽等）来合成元音和辅音。该工具集成了多种发声类型预设，非常适合语音学教学和语音合成研究。

## 主要功能

### 1. 参数化语音合成
- **Klatt 1980 模型**：完整实现了经典的串联/并联共振峰合成模型。
- **多参数控制**：支持对几十个合成参数进行精细调节，包括：
  - **声源参数**：F0 (基频), AV (浊音振幅), AH (清音振幅), OQ (开商), SQ (速度商), TL (倾斜度) 等。
  - **声道参数**：F1-F6 (共振峰频率), B1-B6 (带宽) 等。

### 2. 交互式曲线编辑
- **时间动态控制**：所有参数均支持随时间变化的曲线编辑，模拟真实语音的动态特性。
- **可视化编辑器**：
  - **绘制**：Shift + 鼠标左键拖动，绘制任意参数曲线。
  - **擦除**：Ctrl + 鼠标左键拖动，恢复默认值。
  - **全局覆盖**：支持输入全局数值或简单的线性插值指令（如 `100; 200` 表示从100线性变到200），快速设定整体趋势。
- **扩展的 F0 范围**：手动绘制基频的上限已提升至 **600Hz**，覆盖绝大多数人类语音范围（包括童声和高音）。

### 3. 发声类型预设 (Voice Quality Presets)
内置 5 种典型的发声类型预设，一键应用复杂的参数组合：
- **常态浊声 (Modal)**：标准发音配置 (HNR 40, Slope -10)。
- **耳语 (Whisper)**：无浊音源，仅气流声 (AV 20, HNR 40)。
- **气声 (Breathy)**：增加气流成分 (H1-H2 10, HNR 20)。
- **嘎裂声 (Creaky)**：低基频，高不规则性 (F0 60, Jitter 3, H1-H2 -10)。
- **假声 (Falsetto)**：高基频，声带张力大 (F0 400, Slope -15)。

### 4. 实时合成与可视化
- **即时反馈**：调整参数后可立即合成音频并播放。
- **波形/语谱图**：同步显示合成语音的波形和宽带/窄带语谱图，方便声学分析。
- **共振峰叠加**：在语谱图上叠加显示的共振峰轨迹，直观展示声道变化。

## 安装与依赖

需要安装以下 Python 库：

```bash
pip install numpy scipy matplotlib parselmouth-praat sounddevice soundfile PyQt6 pyqtgraph
```

## 使用指南

### 启动程序
```bash
python klatt_gui.py
```

### 基础操作
1. **选择参数**：在左侧列表选择要编辑的参数（如 `F0` 或 `F1`）。
2. **编辑曲线**：在右侧绘图区使用 Shift+拖动 绘制参数轨迹。
3. **应用预设**：点击菜单栏的 **"发声类型预设"**，选择一种类型（如 "气声"），观察参数变化。
4. **合成播放**：点击底部的 **"合成"** 和 **"播放"** 按钮试听。

### 高级技巧
- **全局设定**：在曲线编辑器顶部的输入框中输入数值（如 `120`）可将整段设为恒定值；输入 `100; 150` 可生成线性过渡。
- **元音模拟**：调整 F1, F2, F3 的数值组合来模拟不同的元音（参考界面内置的元音共振峰表）。

## 许可证
MIT License
